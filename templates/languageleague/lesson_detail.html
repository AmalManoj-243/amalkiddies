{% extends 'base.html' %}
{% block content %}
<div class="page-section">
<div class="container py-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <h2>{{ lesson.title }}</h2>
      <div class="mb-3">
        <p>{{ lesson.content }}</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-light mb-3">
        <div class="card-body">
          <h5 class="card-title">Badges Earned</h5>
          {% for badge in badges %}
            <span class="badge bg-success mb-1">{{ badge.name }}</span>
          {% empty %}
            <span class="text-muted">No badges yet.</span>
          {% endfor %}
        </div>
      </div>
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">Notifications</h5>
          {% for note in notifications %}
            <div class="alert alert-info mb-1">{{ note }}</div>
          {% empty %}
            <span class="text-muted">No notifications.</span>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <h3 class="mb-3">Exercises</h3>
  <form method="post">
    {% csrf_token %}
    <div class="row">
      {% for exercise in exercises %}
        <div class="col-md-6 mb-4">
          <div class="card exercise-block h-100">
            <div class="card-body">
              <strong>{{ exercise.question }}</strong><br>
              {% if exercise.exercise_type == 'quiz' %}
                {% for key, value in exercise.options.items %}
                  <label class="form-check-label"><input type="radio" class="form-check-input" name="ex{{ exercise.id }}" value="{{ key }}"> {{ value }}</label><br>
                {% endfor %}
              {% elif exercise.exercise_type == 'fill' %}
                <input type="text" name="ex{{ exercise.id }}" class="form-control" placeholder="Your answer">
              {% elif exercise.exercise_type == 'match' %}
                <em>Matching exercise (UI coming soon)</em>
              {% elif exercise.exercise_type == 'drag' %}
                <em>Drag-and-drop exercise (UI coming soon)</em>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary">Submit Answers</button>
  </form>
  {% if feedback %}
    <div class="alert alert-info mt-3">{{ feedback }}</div>
  {% endif %}
{# --- Unified Activity Section for Each Lesson --- #}
<div class="card p-4 mb-5 shadow-lg activity-section" style="border-radius:1.5rem; background:linear-gradient(135deg,#f8ffae 0%,#43c6ac 100%);">
  <div class="d-flex align-items-center mb-3" style="gap:12px;">
    <span style="font-size:2rem;">üé®</span>
    <h2 class="fw-bold mb-0" style="color:#d90429; font-family:'Comic Sans MS', 'Comic Sans', cursive;">Activity Time!</h2>
  </div>
  <p class="mb-3" style="font-size:1.15rem; color:#005f73; font-family:'Comic Sans MS', 'Comic Sans', cursive;">
    Try activities for <strong>{{ lesson.title }}</strong>! Draw, upload, and view your artwork.<br>
    <span style="background:#fffbe6; border-radius:8px; padding:2px 8px;">Pick any topic and get creative!</span>
  </p>
  <div class="row g-3 justify-content-center">
    <div class="col-md-4 text-center mb-2">
      <a href="/kids/digital_drawing/?lesson_id={{ lesson.id }}" class="btn btn-lg btn-warning w-100" style="border-radius:2rem; font-size:1.1rem; font-weight:bold; letter-spacing:1px; box-shadow:0 2px 8px rgba(0,0,0,0.10);">
        <span style="font-size:1.3rem;">&#9998;</span> Draw Now (Digital Drawing Game)
      </a>
    </div>
    <div class="col-md-4 text-center mb-2">
      <a href="{% url 'upload_drawing' lesson.id %}" class="btn btn-lg btn-success w-100" style="border-radius:2rem; font-size:1.1rem; font-weight:bold; letter-spacing:1px; box-shadow:0 2px 8px rgba(0,0,0,0.10);">
        <span style="font-size:1.3rem;">üì§</span> Upload Your Drawing
      </a>
    </div>
    <div class="col-md-4 text-center mb-2">
      <a href="{% url 'drawing_gallery' lesson.id %}" class="btn btn-lg btn-info w-100" style="border-radius:2rem; font-size:1.1rem; font-weight:bold; letter-spacing:1px; box-shadow:0 2px 8px rgba(0,0,0,0.10);">
        <span style="font-size:1.3rem;">üñºÔ∏è</span> View Your Gallery
      </a>
    </div>
  </div>
</div>
<div class="card game-time-card" style="max-width: 340px; margin: 18px auto 24px auto; background: linear-gradient(135deg, #ffe5e5 0%, #e0f7fa 100%); border-radius: 2rem; box-shadow: 0 8px 24px #ffd60a55; padding: 1.2rem 1rem; border: 4px dashed #ffd60a; position: relative; overflow: hidden;">
  <div style="position: absolute; top: -18px; right: -18px; opacity: 0.18; font-size: 4.5rem; pointer-events: none;">üé®</div>
  <h2 style="color: #d90429; font-family: 'Luckiest Guy', 'Comic Sans MS', cursive; font-size: 1.5rem; letter-spacing: 2px; text-shadow: 2px 2px 0 #ffd60a, 0 4px 12px #ff980044; margin-bottom: 0.7rem;">
    <span style="font-size:2rem;">üß©</span> Game Time!
  </h2>
  <div class="game-desc" style="font-size: 1.05rem; color: #005f73; margin-bottom: 0.7rem; font-family: 'Baloo 2', cursive; background: #fffbe6; border-radius: 1rem; padding: 0.4rem 0.7rem; box-shadow: 0 2px 8px #ffd60a33;">
    Try a fun game for <strong>{{ lesson.title }}</strong>! Mix colors, match shapes, or build words.
  </div>
  <a href="/kids/digital_drawing/?lesson_id={{ lesson.id }}" class="game-btn" style="background: linear-gradient(90deg,#ff9800 60%,#ffd60a 100%); color: #fff; border: none; border-radius: 1.2rem; padding: 10px 18px; font-size: 1em; font-weight: bold; cursor: pointer; margin: 8px 4px; box-shadow: 0 4px 12px #ffd60a44; transition: background 0.2s, transform 0.2s, box-shadow 0.2s; animation: btnBounce 2s infinite alternate;">
    <span style="font-size:1.2rem;">üéÆ</span> Play Now
  </a>
</div>
{# --- End Unified Activity Section --- #}
</div>
</div>
<style>
.exercise-block { margin-bottom: 20px; }
.page-section {
  margin-top: 60px;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}
@media (max-width: 900px) {
  .page-section { max-width: 100%; }
}
@media (max-width: 768px) {
  .page-section { margin-top: 40px; }
}
</style>
{% endblock %}
