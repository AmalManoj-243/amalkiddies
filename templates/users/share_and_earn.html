{% extends 'home.html' %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 text-center">
      <h2 class="mb-4">Share and Earn Loyalty Points!</h2>
      <div class="mb-4">
        <h4 class="mb-3">Choose what to share:</h4>
        <div id="shareAppSection" style="display:block;">
          <strong>Your Referral Link:</strong>
          <div class="input-group mb-2">
            <input type="text" class="form-control" value="http://{{ request.get_host }}/invite/{{ user.userprofile.referral_code }}" id="referralLink" readonly>
            <button class="btn btn-outline-secondary share-btn" onclick="copyReferralLink()"><i class="fas fa-copy"></i> Copy</button>
          </div>
          <a href="https://wa.me/?text=Join%20me%20on%20BookMyShow%20Clone!%20Use%20my%20referral%20link:%20http://{{ request.get_host }}/invite/{{ user.userprofile.referral_code }}" target="_blank" class="btn btn-success mx-2 share-btn"><i class="fab fa-whatsapp"></i> Share on WhatsApp</a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://{{ request.get_host }}/invite/{{ user.userprofile.referral_code }}" target="_blank" class="btn btn-primary mx-2 share-btn"><i class="fab fa-facebook"></i> Share on Facebook</a>
          <a href="https://twitter.com/intent/tweet?text=Join%20me%20on%20BookMyShow%20Clone!%20Use%20my%20referral%20link:%20http://{{ request.get_host }}/invite/{{ user.userprofile.referral_code }}" target="_blank" class="btn btn-info mx-2 share-btn"><i class="fab fa-twitter"></i> Share on Twitter</a>
          <script>
            function copyReferralLink() {
              var copyText = document.getElementById("referralLink");
              copyText.select();
              copyText.setSelectionRange(0, 99999); // For mobile devices
              document.execCommand("copy");
              copyText.blur();
              var popup = document.createElement('div');
              popup.innerHTML = "Referral link copied!";
              popup.style.position = 'fixed';
              popup.style.top = '30px';
              popup.style.right = '30px';
              popup.style.background = '#007bff';
              popup.style.color = '#fff';
              popup.style.padding = '12px 24px';
              popup.style.borderRadius = '8px';
              popup.style.fontSize = '1rem';
              popup.style.zIndex = '9999';
              popup.style.boxShadow = '0 2px 12px rgba(0,123,255,0.18)';
              document.body.appendChild(popup);
              setTimeout(function() { popup.remove(); }, 2000);
            }
          </script>
        </div>
      {% if messages %}
        <script>
          window.onload = function() {
            var msg = `{% for message in messages %}{{ message }}{% endfor %}`;
            if (msg) {
              var popup = document.createElement('div');
              popup.innerHTML = msg;
              popup.style.position = 'fixed';
              popup.style.top = '30px';
              popup.style.right = '30px';
              popup.style.background = '#28a745';
              popup.style.color = '#fff';
              popup.style.padding = '18px 32px';
              popup.style.borderRadius = '12px';
              popup.style.fontSize = '1.2rem';
              popup.style.zIndex = '9999';
              popup.style.boxShadow = '0 2px 12px rgba(40,167,69,0.18)';
              document.body.appendChild(popup);
              setTimeout(function() { popup.remove(); }, 3500);
            }
          };
        </script>
      {% endif %}
  <!-- Confirm button removed: points are awarded only for successful referral registrations -->
      <script>
        // Enable Confirm Share button only after a share link is clicked
        function enableConfirmShare() {
          document.getElementById('confirmShareBtn').disabled = false;
        }
        window.onload = function() {
          // Popup for messages
          var msg = `{% if messages %}{% for message in messages %}{{ message }}{% endfor %}{% endif %}`;
          if (msg) {
            var popup = document.createElement('div');
            popup.innerHTML = msg;
            popup.style.position = 'fixed';
            popup.style.top = '30px';
            popup.style.right = '30px';
            popup.style.background = '#28a745';
            popup.style.color = '#fff';
            popup.style.padding = '18px 32px';
            popup.style.borderRadius = '12px';
            popup.style.fontSize = '1.2rem';
            popup.style.zIndex = '9999';
            popup.style.boxShadow = '0 2px 12px rgba(40,167,69,0.18)';
            document.body.appendChild(popup);
            setTimeout(function() { popup.remove(); }, 3500);
          }
          // Attach event listeners to all share links
          var shareLinks = document.querySelectorAll('.share-btn');
          shareLinks.forEach(function(link) {
            ['click', 'mousedown', 'touchstart'].forEach(function(evt) {
              link.addEventListener(evt, enableConfirmShare);
            });
          });
        };
      </script>
    </div>
  </div>
</div>
{% endblock %}
