{% extends "users/basic.html" %}
{% block content %}
<div class="container mt-5 night-theme">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg border-0" id="ticket-card" style="background:#23272f; color:#fff;">
        <div class="row no-gutters">
          <div class="col-md-4 d-flex align-items-center justify-content-center p-3" style="background:#181a20;">
            <img src="{{ booking.movie.poster.url }}" alt="{{ booking.movie.name }} poster" class="img-fluid rounded" style="max-height:260px; box-shadow:0 2px 12px rgba(0,0,0,0.18); border:2px solid #ff4066;">
          </div>
          <div class="col-md-8">
            <div class="card-header text-center" style="background:#181a20; color:#ff4066; border-bottom:1px solid #444;">
              <h3 class="mb-0"><i class="fas fa-ticket-alt"></i> Your Ticket</h3>
            </div>
            <div class="card-body" style="background:#23272f; color:#fff;">
              <div class="ticket-details p-3 rounded" style="background:#181a20; color:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.18); border:1px solid #444;">
                <h4 class="mb-3" style="color:#ff4066;">{{ booking.movie.name }}</h4>
                <p><strong style="color:#ff4066;">Theater:</strong> {{ booking.show.theater.name }}</p>
                <p><strong style="color:#ff4066;">Seats:</strong>
                  {% for seat in booking.seats.all %}
                    <span class="badge badge-danger px-2 py-1">{{ seat.seat_number }}</span>
                  {% empty %}
                    <span class="text-muted">No seats booked.</span>
                  {% endfor %}
                </p>
                <p><strong style="color:#ff4066;">Date:</strong> {{ booking.show.date|date:"F d, Y" }}</p>
                <p><strong style="color:#ff4066;">Time:</strong> {{ booking.show.time|time:"H:i" }}</p>
                <p><strong style="color:#ff4066;">Format:</strong> {{ booking.show.format }}</p>
                <p><strong style="color:#ff4066;">Booking Time:</strong> {{ booking.booked_at|date:"F d, Y H:i" }}</p>
                <hr style="border-color:#444;">
                <p class="mb-1" style="color:#ff4066;"><i class="fas fa-envelope"></i> Confirmation sent to your email.</p>
              </div>

                            <div class="mt-4 d-flex justify-content-between">
                                <a href="/" class="btn btn-outline-light"><i class="fas fa-home"></i> Go to Home</a>
                                <button class="btn btn-success" onclick="downloadTicket()"><i class="fas fa-download"></i> Download Ticket</button>
                                <button class="btn btn-warning" data-toggle="modal" data-target="#giftTicketModal"><i class="fas fa-gift"></i> Gift Ticket</button>
                            </div>

<!-- Gift Ticket Modal -->
<div class="modal fade" id="giftTicketModal" tabindex="-1" role="dialog" aria-labelledby="giftTicketModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form method="post" action="{% url 'gift_ticket' booking.id %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="giftTicketModalLabel"><i class="fas fa-gift"></i> Gift Ticket</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="recipient_name">Recipient Name</label>
            <input type="text" class="form-control" id="recipient_name" name="recipient_name" required>
          </div>
          <div class="form-group">
            <label for="recipient_email">Recipient Email</label>
            <input type="email" class="form-control" id="recipient_email" name="recipient_email" required>
          </div>
          <div class="form-group">
            <label for="message">Message (optional)</label>
            <textarea class="form-control" id="message" name="message" rows="2"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-warning"><i class="fas fa-gift"></i> Send Gift</button>
        </div>
      </form>
    </div>
  </div>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
function downloadTicket() {
  const ticket = document.getElementById('ticket-card');
  html2canvas(ticket).then(function(canvas) {
    const link = document.createElement('a');
    link.download = 'ticket.png';
    link.href = canvas.toDataURL();
    link.click();
  });
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
{% endblock %}
