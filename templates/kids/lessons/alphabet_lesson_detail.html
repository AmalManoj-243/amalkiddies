{% extends 'base.html' %}
{% load alphabet_extras %}
{% block content %}
{% if lesson.title %}
  <h1 style="font-family:'Baloo 2',cursive; color:#ff4066; font-size:2.5rem; text-align:center; margin-bottom:2rem; letter-spacing:1px;">{{ lesson.title }}</h1>
{% endif %}
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
<style>
  body, h1, h2, h3, h4, h5, h6, .lesson-title, .alphabet-card, .tracing-btn {
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
  }
  .responsive-video iframe,
  .responsive-video video {
    width: 100% !important;
    height: auto !important;
    max-width: 100vw;
    max-height: 60vw;
    min-height: 180px;
    border-radius: 1rem;
    background: #000;
    display: block;
    margin: 0 auto;
  }
  @media (max-width: 600px) {
    .responsive-video iframe,
    .responsive-video video {
      min-height: 120px;
      max-height: 40vw;
    }
  }
  .responsive-video iframe {
    width: 100%;
    height: 100%;
    border-radius: 1rem;
    background: #000;
    cursor: pointer;
    pointer-events: auto;
    touch-action: manipulation;
  }
  /* Removed duplicate alphabet-grid and alphabet-card definitions for clarity */
  @media (max-width: 900px) {
    .alphabet-grid {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.8rem;
      max-width: 100vw;
    }
    .alphabet-card {
      max-width: 140px;
      font-size: 1.5rem;
      min-height: 120px;
      padding: 0.8rem 0.3rem;
    }
    .example-img {
      max-width: 60px;
      max-height: 60px;
    }
  }
  @media (max-width: 600px) {
    .alphabet-grid {
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 0.5rem;
      margin: 1rem auto;
    }
    .alphabet-card {
      max-width: 100px;
      font-size: 1rem;
      min-height: 80px;
      padding: 0.5rem 0.1rem;
    }
    .example-img {
      max-width: 40px;
      max-height: 40px;
    }
  }
  body {
    background: linear-gradient(120deg, #f8ffae 0%, #e0f7fa 100%, #ffd6e0 120%);
    overflow-x: hidden;
  }
  .confetti {
    position: fixed;
    left: 50vw;
    top: 50vh;
    font-size: 2.5rem;
    pointer-events: none;
    animation: confettiAnim 1.2s ease-out;
  }
  @keyframes confettiAnim {
    0% { opacity: 1; transform: scale(1) translateY(0); }
    100% { opacity: 0; transform: scale(1.5) translateY(80px); }
  }
  .alphabet-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1.2rem;
    margin: 2rem 0;
    justify-items: center;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
  }
  @media (max-width: 1200px) {
    .alphabet-grid {
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
    }
  }
  @media (max-width: 900px) {
    .alphabet-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 0.8rem;
    }
    .lesson-title {
      font-size: 1.5rem;
    }
    .alphabet-card {
      font-size: 1.5rem;
      padding: 0.8rem 0.3rem;
    }
  }
  @media (max-width: 600px) {
    .alphabet-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.6rem;
    }
    .lesson-title {
      font-size: 1.1rem;
    }
    .alphabet-card {
      font-size: 1.1rem;
      padding: 0.5rem 0.1rem;
    }
    .video-section iframe {
      height: 180px !important;
    }
  }
  .alphabet-card {
    background: linear-gradient(135deg, #f8ffae 60%, #e0f7fa 100%);
    border-radius: 1.2rem;
    box-shadow: 0 2px 12px #ffd60a22;
    border: 2px solid #ff9800;
    text-align: center;
    padding: 1.2rem 0.5rem;
    font-size: 2.2rem;
    font-family: 'Baloo 2', cursive;
    color: #2d6a4f;
    font-weight: bold;
    transition: transform 0.25s cubic-bezier(.4,0,.2,1), box-shadow 0.25s cubic-bezier(.4,0,.2,1), background 0.25s cubic-bezier(.4,0,.2,1), border-color 0.25s cubic-bezier(.4,0,.2,1);
    cursor: pointer;
    position: relative;
    will-change: transform, box-shadow, background, border-color;
    width: 100%;
    max-width: 180px;
    min-width: 120px;
    min-height: 180px;
    box-sizing: border-box;
  }
  .alphabet-card:hover {
    transform: scale(1.06);
    box-shadow: 0 12px 32px #ffd60a55, 0 2px 8px #e0f7fa88;
    background: linear-gradient(135deg, #fffbe6 60%, #ffe066 100%);
    z-index: 2;
  }
  @keyframes bounceIn {
    0% { transform: scale(0.7); opacity: 0.2; }
    80% { transform: scale(1.15); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }
  @keyframes flipCard {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(360deg); }
  }
  .example-img {
    width: 38px;
    height: 38px;
    object-fit: contain;
    margin-bottom: 0.2rem;
    border-radius: 0.5rem;
    background: #fffbe6;
    box-shadow: 0 2px 8px #ffd60a22;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  .tracing-btn {
    margin-top: 0.5rem;
    border-radius: 1rem;
    background: linear-gradient(90deg,#ffd60a 0%,#a7ffeb 100%);
    color: #2d6a4f;
    font-family: 'Baloo 2', cursive;
    font-weight: bold;
    box-shadow: 0 2px 8px #ffd60a22;
    border: none;
    padding: 0.3rem 1.1rem;
    cursor: pointer;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    font-size: 1rem;
  }
  .tracing-btn:hover {
    background: #ff4066;
    color: #fff;
    box-shadow: 0 8px 24px #ffd60a44;
  }
  .progress-stars {
    margin: 1rem 0 0.5rem 0;
    text-align: center;
    font-size: 1.5rem;
    color: #ffd60a;
  }
  .fun-fact {
    font-size: 0.95rem;
    color: #ff4066;
    margin-top: 0.3rem;
    font-family: 'Comic Sans MS', cursive;
    background: #fffbe6;
    border-radius: 0.7rem;
    padding: 0.2rem 0.7rem;
    box-shadow: 0 2px 8px #ffd60a22;
  }
  .example-word {
    font-size: 1.1rem;
    color: #005f73;
    margin-top: 0.5rem;
    font-family: 'Comic Sans MS', cursive;
  }
  .lesson-title {
    font-size: 2.2rem;
    font-family: 'Baloo 2', cursive;
    color: #ff4066;
    font-weight: bold;
    margin-bottom: 1.2rem;
    text-align: center;
  }
  .video-section {
    margin: 2rem 0;
    text-align: center;
  }
  .main-poster-card {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 2.5rem;
  }
  .main-poster-card div {
    background: linear-gradient(120deg,#fffbe6 0%,#e0f7fa 100%,#ffd6e0 120%);
    border-radius: 2rem;
    box-shadow: 0 8px 32px #ffd60a55;
    padding: 2rem 2.5rem;
    max-width: 420px;
    text-align: center;
  }
  .main-poster-card h2 {
    font-family: 'Baloo 2', cursive;
    color: #005f73;
    font-size: 2.2rem;
    margin-bottom: 1.2rem;
    letter-spacing: 1px;
  }
  .main-poster-card img {
    max-width: 370px;
    width: 100%;
    height: auto;
    border-radius: 1.5rem;
    box-shadow: 0 6px 32px #ffd60a44;
    margin-bottom: 1.2rem;
  }
  .main-poster-card .lesson-title {
    font-family: 'Baloo 2', cursive;
    font-size: 1.3rem;
    color: #ff4066;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }
  .poster-card {
    display: inline-block;
    margin: 1rem;
    padding: 1rem;
    background: #fff;
    border-radius: 1.2rem;
    box-shadow: 0 2px 8px #ffd60a22;
    text-align: center;
    max-width: 220px;
    min-width: 220px;
    min-height: 340px;
    max-height: 340px;
    position: relative;
    vertical-align: top;
  }
  .poster-card img {
    max-width: 180px;
    max-height: 180px;
    border-radius: 1rem;
    box-shadow: 0 2px 8px #ffd60a44;
    margin-bottom: 0.7rem;
  }
</style>
<div class="container py-4">
  <!-- Tracing Canvas Modal -->
  <div id="tracingModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:#fffbe6; border-radius:2rem; box-shadow:0 8px 32px #ffd60a55; padding:2rem; max-width:95vw; max-height:90vh; display:flex; flex-direction:column; align-items:center;">
      <h2 id="tracingTitle" style="font-family:'Baloo 2',cursive; color:#ff4066; font-size:2rem; margin-bottom:1rem;">Trace the Letter</h2>
      <canvas id="tracingCanvas" width="320" height="320" style="border:2px solid #ffd60a; border-radius:1.5rem; background:#fff; box-shadow:0 4px 16px #ffd60a44; touch-action: none;"></canvas>
      <button onclick="closeTracing()" style="margin-top:1.2rem; border-radius:1rem; background:linear-gradient(90deg,#ffd60a 0%,#a7ffeb 100%); color:#2d6a4f; font-family:'Baloo 2',cursive; font-weight:bold; box-shadow:0 2px 8px #ffd60a22; border:none; padding:0.6rem 2rem; font-size:1.1rem; cursor:pointer;">Close</button>
    </div>
  </div>
  <div class="main-poster-card" style="display:flex; justify-content:center; align-items:center; margin-bottom:2.5rem;">
    <div style="background:linear-gradient(120deg,#fffbe6 0%,#e0f7fa 100%,#ffd6e0 120%); border-radius:2rem; box-shadow:0 8px 32px #ffd60a55; padding:2rem 2.5rem; max-width:420px; text-align:center;">
      {% if lesson.poster_image %}
        <img src="{{ lesson.poster_image.url }}" alt="{{ lesson.title }} Poster" style="max-width:370px; width:100%; height:auto; border-radius:1.5rem; box-shadow:0 6px 32px #ffd60a44; margin-bottom:1.2rem;">
      {% else %}
        <div style="color:#888; font-size:1.1rem;">No main poster uploaded for this lesson yet.</div>
      {% endif %}
    </div>
  </div>
  <div class="video-section">
    {% for video in lesson_videos %}
      <div style="max-width:650px; margin:2rem auto 2.5rem auto; text-align:center;">
        <h2 style="font-family:'Baloo 2',cursive; color:#ff9800; font-size:2rem; margin-bottom:1.2rem;">{{ video.title }}</h2>
        <div class="responsive-video" style="width:100%; max-width:600px; margin:auto; aspect-ratio:16/9; background:#000; border-radius:1rem; box-shadow:0 4px 24px #ffd60a22; display:flex; align-items:center; justify-content:center;">
          {% if video.video_url and 'youtube.com' in video.video_url or 'youtu.be' in video.video_url %}
            <iframe src="{{ video.video_embed_url }}" title="{{ video.title }}" frameborder="0" allowfullscreen style="width:100%; height:100%; min-height:220px; min-width:320px; border-radius:1.5rem; background:#000; display:block; margin:0 auto;"></iframe>
          {% else %}
            <video controls style="width:100%; height:auto; border-radius:1rem; background:#000; display:block; margin:0 auto;" preload="metadata">
              <source src="{{ video.video_url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <div style="margin-top:0.7rem;">
              <a href="{{ video.video_url }}" target="_blank" style="color:#ff9800; font-size:1rem; text-decoration:underline;">Open video in new tab</a>
            </div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#ff4066; font-size:1.2rem;">No videos available</div>
    {% endfor %}
  <div class="progress-stars" id="progressStars" style="font-family:'Baloo 2',cursive; color:#005f73; font-size:2rem; text-align:center; margin:1.5rem 0; letter-spacing:1px; font-weight:bold;">
    Trace and Learn
  </div>
  <div class="alphabet-grid">
    {% for letter, word in alphabet_words.items %}
      <div class="alphabet-card bounce-in" onclick="showLetterFeatures('{{ letter }}', '{{ word }}')" style="display:flex; flex-direction:column; align-items:center; justify-content:space-between; height:100%;">
        <div style="width:100%; display:flex; justify-content:center; align-items:center; margin-bottom:0.5rem;">
          <img src="{{ alphabet_images|get_item:letter }}" alt="{{ word }}" class="example-img" style="width:100px; height:100px; max-width:120px; max-height:120px; border-radius:1.2rem; box-shadow:0 4px 16px #ffd60a44; background:#fffbe6;">
        </div>
        <div style="width:100%; text-align:center;">
          <div style="font-family:'Baloo 2',cursive; font-weight:bold; font-size:2.7rem; color:#ff4066; text-shadow:0 2px 12px #ffd60a88; margin-bottom:0.2rem;">
            <span style="font-size:2.7rem; color:#ff4066;">{{ letter|upper }}</span>
            <span style="font-size:2.7rem; color:#ff9800; margin-left:0.3rem;">{{ letter|lower }}</span>
          </div>
          <span class="example-word" style="display:block; margin-bottom:0.6rem;">{{ word }}</span>
        </div>
        <div style="width:100%; display:flex; justify-content:center; align-items:center; margin-top:auto;">
          <button class="tracing-btn" onclick="openTracing('{{ letter }}'); event.stopPropagation();">✏️ Trace</button>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="lesson-posters-section" style="margin-bottom:2rem;">
    <h2 style="font-family:'Baloo 2',cursive; color:#005f73; font-size:2rem; margin-bottom:1rem; text-align:left;">Additional Posters</h2>
    <div class="poster-carousel" style="display:flex; overflow-x:auto; gap:1.5rem; padding-bottom:1rem; scrollbar-width:thin; scrollbar-color:#ffd60a #fffbe6;">
      {% for poster in lesson.posters.all %}
        <div class="poster-card" style="display:inline-block; margin:1rem; padding:1rem; background:#fff; border-radius:1.2rem; box-shadow:0 2px 8px #ffd60a22; text-align:center; max-width:220px; position:relative; min-height:340px;">
          <img src="{{ poster.image.url }}" alt="Poster" style="max-width:180px; max-height:180px; border-radius:1rem; box-shadow:0 2px 8px #ffd60a44; margin-bottom:0.7rem;">
          {% if poster.title %}
            <div style="font-weight:bold; font-size:1.1rem; color:#ff4066; margin-bottom:0.3rem;">{{ poster.title }}</div>
          {% endif %}
          {% if poster.description %}
            <div style="font-size:1rem; color:#005f73; margin-bottom:0.2rem;">{{ poster.description }}</div>
          {% endif %}
          <div style="position:absolute; left:0; right:0; bottom:1rem;">
            <a href="{{ poster.image.url }}" download class="btn btn-primary" style="border-radius:0.7rem; background:linear-gradient(90deg,#43e97b 0%,#38f9d7 100%); color:#fff; font-weight:bold; box-shadow:0 2px 8px #38f9d799; padding:0.4rem 1.2rem; font-size:1rem; width:80%; margin:auto; display:block;">Download</a>
          </div>
        </div>
      {% empty %}
        <div style="color:#888; font-size:1.1rem;">No additional posters for this lesson.</div>
      {% endfor %}
    </div>
  </div>
  <div class="mt-4 text-center">
  <div id="quiz-section" class="mt-5" style="padding:2rem 0; background:linear-gradient(90deg,#e0f7fa 0%,#ffd6e0 100%); border-radius:2rem; box-shadow:0 4px 18px #ffd60a44;">
    <h2 style="font-family:'Baloo 2', cursive; color:#ff4066; font-size:2rem; text-align:center; margin-bottom:1rem;">Alphabet Quiz</h2>
    <p style="text-align:center; font-size:1.1rem; color:#2d6a4f; margin-bottom:1.2rem; max-width:600px; margin-left:auto; margin-right:auto;">
      <b>Lesson Completion:</b> Complete the Alphabet Quiz to finish this lesson. You must score at least <b>20 out of 26</b> to mark the lesson as complete. You can retry the quiz until you succeed. Only a successful attempt updates your lesson status.
    </p>
    <div class="text-center">
      <div id="quiz-btn-panel" style="display:inline-block; background:linear-gradient(90deg,#43e97b 0%,#38f9d7 100%); border-radius:2rem; box-shadow:0 4px 18px #38f9d799; padding:1.2rem 2.2rem; margin-bottom:1rem;">
        <a href="{% url 'alphabet_quiz' %}" id="take-quiz-btn" class="btn btn-lg" style="background:linear-gradient(90deg,#ffd60a 0%,#ff9800 100%); color:#2d6a4f; border-radius:1rem; font-size:1.05rem; font-family:'Baloo 2', cursive; font-weight:bold; box-shadow:0 2px 8px #ffd60a88; padding:0.4rem 1.1rem; transition:transform 0.2s; display:flex; align-items:center; gap:0.5rem;">
          <span style="font-size:1.7rem; vertical-align:middle;">📝</span>
          <span>Attend Quiz</span>
          <span id="quiz-status-badge" style="margin-left:1rem; font-size:1.1rem; font-weight:bold; padding:0.3rem 1rem; border-radius:1rem; background:#fffbe6; color:#2d6a4f; box-shadow:0 2px 8px #ffd60a44; border:2px solid #ffd60a;">
            {% if completion and completion.completed_quiz %}
              Completed
            {% else %}
              Not Completed
            {% endif %}
          </span>
        </a>
      </div>
    </div>
  </div>
  </div>
  <div id="mainPosterModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:9999; align-items:center; justify-content:center;">
    <img id="mainPosterImg" src="" alt="Poster" style="max-width:90vw; max-height:90vh; border-radius:2rem; box-shadow:0 8px 32px #ffd60a88;">
  </div>
</div>
<script>
  // Robust scroll to quiz button if ?scroll=quiz is present
  document.addEventListener('DOMContentLoaded', function() {
    var params = new URLSearchParams(window.location.search);
    if (params.get('scroll') === 'quiz') {
      var quizBtn = document.getElementById('take-quiz-btn');
      if (quizBtn) {
        setTimeout(function() {
          quizBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 400);
      }
    }
  });
  // Smooth scroll to quiz button if anchor is present (run after all content)
  document.addEventListener('DOMContentLoaded', function() {
    if (window.location.hash === '#take-quiz-btn') {
      var quizBtn = document.getElementById('take-quiz-btn');
      if (quizBtn) {
        setTimeout(function() {
          quizBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 400);
      }
    }
  });
  // Quiz status logic
  // Quiz status badge is now set by backend value only.
  function showLetterFeatures(letter, word) {
    speakLetter(letter, word);
    document.querySelectorAll('.fun-fact').forEach(f => f.style.display = 'none');
    var bubble = document.getElementById('funFact-' + letter);
    if(bubble) {
      bubble.style.display = 'block';
      bubble.style.animation = 'bounceIn 0.7s cubic-bezier(.4,0,.2,1)';
      setTimeout(function(){ bubble.style.display = 'none'; }, 2200);
    }
    showConfetti();
  }
  function speakLetter(letter, word) {
    function doSpeak() {
      var utter = new SpeechSynthesisUtterance(letter + ' for ' + word);
      utter.lang = 'en-US';
      utter.pitch = 0.6;
      utter.rate = 0.85;
      var voices = window.speechSynthesis.getVoices();
      var femaleVoice = voices.find(v => v.lang.startsWith('en') && (v.gender === 'female' || v.name.toLowerCase().includes('female') || v.name.toLowerCase().includes('girl')));
      if (!femaleVoice) {
        femaleVoice = voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('samantha'));
      }
      if (!femaleVoice) {
        femaleVoice = voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('zira'));
      }
      if (femaleVoice) utter.voice = femaleVoice;
      window.speechSynthesis.speak(utter);
    }
    if (window.speechSynthesis.getVoices().length === 0) {
      window.speechSynthesis.onvoiceschanged = doSpeak;
    } else {
      doSpeak();
    }
  }
  function openTracing(letter) {
    // Show modal
    document.getElementById('tracingModal').style.display = 'flex';
    document.getElementById('tracingTitle').innerText = 'Trace the Letter ' + letter;
    // Draw worksheet-style tracing: two horizontal lines, each with uppercase and lowercase letters
    var canvas = document.getElementById('tracingCanvas');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    // Draw two sets of uppercase and lowercase letters, then horizontal lines at their base
    var canvas = document.getElementById('tracingCanvas');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.font = '140px "Baloo 2", Arial, sans-serif';
    ctx.strokeStyle = '#ffd60a';
    ctx.lineWidth = 5;
    ctx.setLineDash([10, 10]);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    var upper = letter.toUpperCase();
    var lower = letter.toLowerCase();
    // y positions for letter baselines
    let baseYs = [160, 300];
    // First line: draw letters
    ctx.strokeText(upper, canvas.width/2 - 60, baseYs[0]);
    ctx.strokeText(lower, canvas.width/2 + 60, baseYs[0]);
    // Second line: draw letters
    ctx.strokeText(upper, canvas.width/2 - 60, baseYs[1]);
    ctx.strokeText(lower, canvas.width/2 + 60, baseYs[1]);
    ctx.setLineDash([]);
    // Draw horizontal lines at the base of each letter pair
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 2;
    ctx.setLineDash([8, 8]);
    for (let y of baseYs) {
      ctx.beginPath();
      ctx.moveTo(30, y + 5);
      ctx.lineTo(canvas.width - 30, y + 5);
      ctx.stroke();
    }
    ctx.setLineDash([]);
    ctx.restore();
    // Enable drawing
    let drawing = false;
    function startDraw(e) {
  drawing = true;
  // Do not call draw(e) on initial click/touch to avoid unwanted lines
    }
    function endDraw() { drawing = false; ctx.beginPath(); }
    function draw(e) {
      if (!drawing) return;
      let rect = canvas.getBoundingClientRect();
      let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      let y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      ctx.lineWidth = 4;
      ctx.strokeStyle = '#ff4066';
      ctx.lineCap = 'round';
      if (ctx.__lastDrawn !== true) {
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.__lastDrawn = true;
        return;
      }
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }
    canvas.onmousedown = startDraw;
    canvas.onmouseup = endDraw;
    canvas.onmouseout = endDraw;
    canvas.onmousemove = draw;
    canvas.ontouchstart = startDraw;
    canvas.ontouchend = endDraw;
    canvas.ontouchcancel = endDraw;
    canvas.ontouchmove = draw;
    showConfetti();
    updateProgress();
  }
  function closeTracing() {
    document.getElementById('tracingModal').style.display = 'none';
  }
  function openQuiz() {
    var questions = [
      {q: 'Which letter comes after B?', a: 'C'},
      {q: 'Which letter comes before D?', a: 'C'},
      {q: 'What is the first letter of Apple?', a: 'A'},
      {q: 'Which letter comes after X?', a: 'Y'},
      {q: 'What is the last letter?', a: 'Z'}
    ];
    var idx = Math.floor(Math.random() * questions.length);
    var user = prompt(questions[idx].q);
    if (user && user.toUpperCase() === questions[idx].a) {
      alert('Correct! 🎉');
      showConfetti();
      updateProgress();
    } else {
      alert('Try again!');
    }
  }
  function showConfetti() {
    var confetti = document.createElement('span');
    confetti.className = 'confetti';
    confetti.innerHTML = '🎉';
    document.body.appendChild(confetti);
    setTimeout(function(){ confetti.remove(); }, 1200);
  }
  function updateProgress() {
    var stars = document.getElementById('progressStars');
    if (stars) {
      stars.innerHTML = '⭐⭐⭐⭐⭐⭐';
      setTimeout(function(){ stars.innerHTML = '⭐⭐⭐⭐⭐'; }, 1500);
    }
  }
  document.addEventListener('DOMContentLoaded', function() {
    var mainPoster = document.querySelector('.main-poster-card img');
    var modal = document.getElementById('mainPosterModal');
    var modalImg = document.getElementById('mainPosterImg');
    if (mainPoster) {
      mainPoster.style.cursor = 'pointer';
      mainPoster.onclick = function() {
        modalImg.src = mainPoster.src;
        modal.style.display = 'flex';
      };
    }
    modal.onclick = function() {
      modal.style.display = 'none';
      modalImg.src = '';
    };
  });
</script>
{% endblock %}
