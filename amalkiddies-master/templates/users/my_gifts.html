{% extends 'home.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="section-title mb-0">Received Gifts</h2>
  <div>
    <button class="btn btn-warning mr-2" data-toggle="modal" data-target="#sendGiftModal" style="font-weight:600; font-size:1rem;">
      <i class="fas fa-gift"></i> Send Gift
    </button>
    <a href="{% url 'gift_settings' %}" class="btn btn-outline-secondary" style="font-weight:600; font-size:1rem;">
      <i class="fas fa-cog"></i> Settings
    </a>
  </div>
</div>

<!-- Dark Mode Styles for Gifts Page -->
<style>
  body.night-theme .section-title,
  body.night-theme .list-group-item,
  body.night-theme .list-group,
  body.night-theme .modal-content {
    background: #23272f !important;
    color: #f1f1f1 !important;
    border-color: #444 !important;
  }
  body.night-theme .list-group-item {
    border: 1px solid #444 !important;
  }
  body.night-theme .badge-success {
    background: #28a745 !important;
    color: #fff !important;
  }
  body.night-theme .badge-warning {
    background: #ff4066 !important;
    color: #fff !important;
  }
  body.night-theme .btn-success {
    background: #181a20 !important;
    color: #ff4066 !important;
    border: 1px solid #444 !important;
  }
  body.night-theme .btn-warning {
    background: #ff4066 !important;
    color: #fff !important;
    border: 1px solid #444 !important;
  }
  body.night-theme .btn-outline-secondary {
    background: #23272f !important;
    color: #ff4066 !important;
    border: 1px solid #444 !important;
  }
</style>
<div class="modal fade" id="sendGiftModal" tabindex="-1" role="dialog" aria-labelledby="sendGiftModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form method="post" action="{% url 'send_gift' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="sendGiftModalLabel"><i class="fas fa-gift"></i> Send Gift</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="booking_id">Select Booking to Gift</label>
            <select class="form-control" id="booking_id" name="booking_id" required>
              {% for booking in bookings %}
                <option value="{{ booking.id }}">{{ booking.movie.name }} - {{ booking.show }} ({{ booking.booked_at|date:'Y-m-d H:i' }})</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="recipient_name">Recipient Name</label>
            <input type="text" class="form-control" id="recipient_name" name="recipient_name" required>
          </div>
          <div class="form-group">
            <label for="recipient_email">Recipient Email</label>
            <input type="email" class="form-control" id="recipient_email" name="recipient_email" required>
          </div>
          <div class="form-group">
            <label for="message">Message (optional)</label>
            <textarea class="form-control" id="message" name="message" rows="2"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-warning"><i class="fas fa-gift"></i> Send Gift</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% if gifts %}
  <ul class="list-group">
    {% for gift in gifts %}
      <li class="list-group-item">
        <strong>From:</strong> {{ gift.sender.username }}<br>
  <strong>Booking:</strong> {{ gift.booking.movie.name }}<br>
  <a href="{% url 'view_ticket' gift.booking.id %}" class="btn btn-sm btn-info mt-2"><i class="fas fa-ticket-alt"></i> View Ticket</a><br>
        <strong>Message:</strong> {{ gift.message|default:'No message' }}<br>
        <strong>Received at:</strong> {{ gift.sent_at|date:'Y-m-d H:i' }}
        {% if not gift.accepted %}
          <span class="badge badge-warning ml-2">Pending</span>
          <form method="post" action="{% url 'accept_gift' gift.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-success ml-2">Accept</button>
          </form>
        {% else %}
          <span class="badge badge-success ml-2">Accepted</span>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-muted">No gifts received yet.</p>
{% endif %}
{% endblock %}
