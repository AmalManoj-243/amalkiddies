{% extends 'users/basic.html' %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  .spin-container {
    padding: 2rem 0;
    max-width: 500px;
    margin: 0 auto;
  }
  #wheelCanvas {
    width: 100%;
    max-width: 400px;
    height: auto;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    box-shadow: 0 4px 24px rgba(255,64,102,0.18);
    display: block;
    margin: 0 auto;
  }
  @media (max-width: 600px) {
    .spin-container {
      padding: 1rem 0;
    }
    #wheelCanvas {
      max-width: 95vw;
    }
    .btn-lg {
      font-size: 1rem;
      padding: 0.75rem 1.5rem;
    }
  }
</style>
<div class="container mt-3 mb-4 spin-container">
  <h2 class="mb-4 text-center">Spin Wheel Game</h2>
  <div class="d-flex justify-content-center">
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
  </div>
  <div class="text-center mt-4">
    <button id="spinBtn" class="btn btn-danger btn-lg">Spin</button>
    <div id="resultMsg" class="mt-4 h4"></div>
  </div>
</div>
<script>
const prizes = [
  'Free Ticket', '50% Off', 'Free Popcorn', '100 Loyalty Points', 'No Win', 'Movie Merchandise', 'Snack Combo', 'Priority Booking'
];
const colors = ['#ff4066','#ff8c40','#23272f','#2d9cdb','#ffc107','#28a745','#6f42c1','#17a2b8'];
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const resultMsg = document.getElementById('resultMsg');
let angle = 0;
let spinning = false;
function drawWheel() {
  const num = prizes.length;
  const arc = 2 * Math.PI / num;
  for(let i=0; i<num; i++) {
    ctx.beginPath();
    ctx.moveTo(200,200);
    ctx.arc(200,200,200,i*arc,(i+1)*arc);
    ctx.closePath();
    ctx.fillStyle = colors[i%colors.length];
    ctx.fill();
    ctx.save();
    ctx.translate(200,200);
    ctx.rotate(i*arc+arc/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 18px Arial';
    ctx.fillText(prizes[i], 170,10);
    ctx.restore();
  }
  // Draw pointer
  ctx.beginPath();
  ctx.moveTo(200,0);
  ctx.lineTo(190,30);
  ctx.lineTo(210,30);
  ctx.closePath();
  ctx.fillStyle = '#ff4066';
  ctx.fill();
}
drawWheel();
spinBtn.onclick = function() {
  if(spinning) return;
  spinning = true;
  let spins = Math.floor(Math.random()*5)+5;
  let finalAngle = angle + spins*2*Math.PI + Math.random()*2*Math.PI;
  let duration = 3000;
  let start = null;
  function animate(ts) {
    if(!start) start = ts;
    let progress = ts-start;
    let currentAngle = angle + (finalAngle-angle)*(progress/duration);
    ctx.clearRect(0,0,400,400);
    ctx.save();
    ctx.translate(200,200);
    ctx.rotate(currentAngle);
    ctx.translate(-200,-200);
    drawWheel();
    ctx.restore();
    if(progress < duration) {
      requestAnimationFrame(animate);
    } else {
      angle = finalAngle % (2*Math.PI);
      spinning = false;
      let winIndex = Math.floor(prizes.length - ((angle/(2*Math.PI))*prizes.length)) % prizes.length;
      resultMsg.innerText = 'You won: ' + prizes[winIndex];
    }
  }
  requestAnimationFrame(animate);
};
</script>
{% endblock %}
