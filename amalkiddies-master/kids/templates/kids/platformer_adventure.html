<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fruit Ninja Game</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
    html, body { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; }
    body { background: linear-gradient(90deg, #f9fbe7 0%, #ffe0b2 100%); }
    #game-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; min-width: 100vw; min-height: 100vh; max-width: 100vw; max-height: 100vh; touch-action: none; overflow: hidden; z-index: 10; }
    .centered { text-align: center; }
    </style>
</head>
<body>
    <div class="container-fluid mt-2 position-relative" style="max-width:100vw; padding:0;">
        <h2 class="centered mb-2" style="font-family: 'Fredoka One', cursive; color: #43a047; font-size:2rem;">Fruit Ninja Game</h2>
        <div class="centered mb-2" style="font-size:1.1rem;color:#333;background:#fff8e1;border-radius:12px;padding:8px 16px;max-width:98vw;margin:0 auto;">
            Slice the flying fruits by dragging across them! Score points for each sliced fruit. Miss 5 fruits and the game ends.<br>Use mouse or touch to slice.
        </div>
        <div id="game-container"></div>
        <div class="centered mt-2 mb-2">
            <a href="/kids/home/" class="btn btn-outline-primary" style="font-size:1.2rem;padding:10px 24px;border-radius:16px;">Back to Kids Home</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <script>
    let gameWidth = window.innerWidth;
    let gameHeight = window.innerHeight;

    // Responsive resize for full screen
    window.addEventListener('resize', () => {
        gameWidth = window.innerWidth;
        gameHeight = window.innerHeight;
        if (window.game && window.game.scale) {
            window.game.scale.resize(gameWidth, gameHeight);
        }
    });
    class FruitNinjaScene extends Phaser.Scene {
        constructor() { super('FruitNinjaScene'); }
        preload() {
            this.load.image('tomato', '/media/movies/tomato.png');
            this.load.image('cauliflower', '/media/movies/cauliflower.png');
            this.load.image('carrot', '/media/movies/carrot.png');
            this.load.image('cabbage', '/media/movies/cabbage.png');
            this.load.image('apple', '/media/movies/apple-439397_640.webp');
            this.load.image('banana', '/media/movies/banana.png');
            this.load.image('orange', '/media/movies/lemon.png'); // Use lemon.png for orange
            this.load.image('watermelon', '/media/movies/watermelon.png');
            this.load.image('strawberry', '/media/movies/strawberry.png');
            this.load.image('grapes', '/media/movies/grapes.png');
            this.load.image('radishh', '/media/movies/radish.png');
            this.load.image('pumpkin', '/media/movies/pumpkin.png');
        }
        create() {
            // Points for each fruit type
            this.fruitPoints = {
                apple: 2,
                banana: 1,
                orange: 3,
                watermelon: 5,
                strawberry: 4,
                grapes: 2,
                radishh: 6,
                pumpkin: 4,
                cabbage: 3,
                carrot: 2,
                cauliflower: 3,
                tomato: 2
            };
            this.fruitTypes = ['apple', 'banana', 'orange', 'watermelon', 'strawberry', 'grapes', 'radishh', 'pumpkin', 'cabbage', 'carrot', 'cauliflower', 'tomato'];
            this.fruitSizes = {
                apple: 62,
                banana: 100,
                orange: 96,
                watermelon: 125,
                strawberry: 115,
                grapes: 104,
                radishh: 150,
                pumpkin: 100,
                cabbage: 120,
                carrot: 150,
                cauliflower: 95,
                tomato: 110
            };
            this.score = 0;
            this.missed = 0;
            this.gameOver = false;
            this.scoreText = this.add.text(16, 8, 'Score: 0', { fontSize: '20px', fill: '#43a047', fontFamily: 'Fredoka One', backgroundColor:'#fff8e1', padding:{left:8,right:8,top:2,bottom:2}, borderRadius:8 }).setScrollFactor(0);
            this.missedText = this.add.text(gameWidth-120, 8, 'Missed: 0', { fontSize: '20px', fill: '#e53935', fontFamily: 'Fredoka One', backgroundColor:'#fff8e1', padding:{left:8,right:8,top:2,bottom:2}, borderRadius:8 }).setScrollFactor(0);
            this.cameras.main.setBackgroundColor('rgba(0,0,0,0)');
            this.fruits = [];
            this.fruitTimer = this.time.addEvent({ delay: 900, callback: this.launchFruit, callbackScope: this, loop: true });
            this.input.on('pointermove', this.sliceFruits, this);
            // Timeout-based game over (e.g., 60 seconds)
            this.timeoutDuration = 60; // seconds
            this.timeLeft = this.timeoutDuration;
            this.timerText = this.add.text(gameWidth/2, 8, 'Time: ' + this.timeLeft, { fontSize: '20px', fill: '#ff9800', fontFamily: 'Fredoka One', backgroundColor:'#fff8e1', padding:{left:8,right:8,top:2,bottom:2}, borderRadius:8 }).setOrigin(0.5, 0);
            this.timeoutEvent = this.time.addEvent({ delay: 1000, callback: () => {
                if (this.gameOver) return;
                this.timeLeft--;
                this.timerText.setText('Time: ' + this.timeLeft);
                if (this.timeLeft <= 0) {
                    this.endGame(true);
                }
            }, callbackScope: this, loop: true });
        }
        launchFruit() {
            if (this.gameOver) return;
            let fruitType = Phaser.Utils.Array.GetRandom(this.fruitTypes);
            let x = Phaser.Math.Between(60, gameWidth-60);
            let y = gameHeight + 40;
            let size = this.fruitSizes[fruitType] || 44;
            let fruit = this.add.image(x, y, fruitType).setOrigin(0.5).setDisplaySize(size, size);
            this.physics.add.existing(fruit);
            let angle = Phaser.Math.FloatBetween(-Math.PI/3, -2*Math.PI/3);
            let speed = Phaser.Math.Between(420, 620);
            fruit.body.setVelocity(Math.cos(angle)*speed, Math.sin(angle)*speed);
            fruit.body.setGravityY(500);
            fruit.body.setCollideWorldBounds(false);
            fruit.sliced = false;
            fruit.fruitType = fruitType;
            fruit.fruitSize = size;
            this.fruits.push(fruit);
        }
        sliceFruits(pointer) {
            if (this.gameOver) return;
            for (let i = this.fruits.length - 1; i >= 0; i--) {
                let fruit = this.fruits[i];
                if (!fruit.sliced && Phaser.Math.Distance.Between(pointer.x, pointer.y, fruit.x, fruit.y) < fruit.fruitSize/2) {
                    fruit.sliced = true;
                    let points = this.fruitPoints[fruit.fruitType] || 1;
                    this.score += points;
                    this.scoreText.setText('Score: ' + this.score + ' (+' + points + ')');

                    // Popup showing points earned
                    const popup = this.add.text(fruit.x, fruit.y - 30, `+${points}`, {
                        font: 'bold 32px Arial',
                        fill: '#ffeb3b',
                        stroke: '#333',
                        strokeThickness: 4,
                        backgroundColor: 'rgba(0,0,0,0.4)'
                    }).setOrigin(0.5);
                    this.tweens.add({
                        targets: popup,
                        y: popup.y - 40,
                        alpha: 0,
                        duration: 800,
                        onComplete: () => popup.destroy()
                    });

                    // Cutting effect: slash line
                    let slash = this.add.graphics();
                    slash.lineStyle(6, 0xff1744, 0.8);
                    slash.beginPath();
                    slash.moveTo(pointer.x-30, pointer.y-30);
                    slash.lineTo(pointer.x+30, pointer.y+30);
                    slash.strokePath();
                    this.tweens.add({ targets: slash, alpha: 0, duration: 350, onComplete: () => slash.destroy() });
                    // Split fruit halves
                    let halfSize = Math.round(fruit.fruitSize/2);
                    let half1 = this.add.image(fruit.x-10, fruit.y, fruit.fruitType).setOrigin(0.5).setDisplaySize(halfSize, fruit.fruitSize).setAngle(-20);
                    let half2 = this.add.image(fruit.x+10, fruit.y, fruit.fruitType).setOrigin(0.5).setDisplaySize(halfSize, fruit.fruitSize).setAngle(20);
                    this.tweens.add({ targets: half1, x: half1.x-40, y: half1.y+40, alpha: 0, angle: -60, duration: 500, onComplete: () => half1.destroy() });
                    this.tweens.add({ targets: half2, x: half2.x+40, y: half2.y+40, alpha: 0, angle: 60, duration: 500, onComplete: () => half2.destroy() });
                    this.tweens.add({ targets: fruit, alpha: 0, duration: 200, onComplete: () => fruit.destroy() });
                    this.fruits.splice(i, 1);
                }
            }
        }
        update() {
            if (this.gameOver) return;
            for (let i = this.fruits.length - 1; i >= 0; i--) {
                let fruit = this.fruits[i];
                if (fruit.y > gameHeight+40 && !fruit.sliced) {
                    fruit.destroy();
                    this.fruits.splice(i, 1);
                    this.missed += 1;
                    this.missedText.setText('Missed: ' + this.missed);
                    // No game over on missed fruits
                }
            }
        }
        endGame(timeout=false) {
            this.gameOver = true;
            this.fruitTimer.remove(false);
            if (this.timeoutEvent) this.timeoutEvent.remove(false);
            let msg = timeout ? 'Time Up!\nScore: ' + this.score : 'Game Over!\nScore: ' + this.score;
            this.add.text(gameWidth/2, gameHeight/2, msg, {
                fontSize: Math.round(36*gameWidth/600), fill: '#e53935', fontFamily: 'Fredoka One', align: 'center', backgroundColor:'#fff8e1', padding:{left:16,right:16,top:8,bottom:8}, borderRadius:16
            }).setOrigin(0.5);
        }
    }
    window.game = new Phaser.Game({
        type: Phaser.AUTO,
        width: gameWidth,
        height: gameHeight,
        parent: 'game-container',
        physics: { default: 'arcade', arcade: { gravity: { y: 0 }, debug: false } },
        scene: FruitNinjaScene
    });
    </script>
</body>
</html>
