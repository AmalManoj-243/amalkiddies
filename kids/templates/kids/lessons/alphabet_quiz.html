{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div id="animated-bg"></div>
  <div id="animated-bg"></div>
  <div id="quiz-game" style="max-width:480px; margin:auto; background:linear-gradient(135deg, #f8fafc 0%, #e0f7fa 100%); border-radius:1.5rem; box-shadow:0 8px 32px #e0e0e0cc; padding:2.5rem 2rem 2rem 2rem; position:relative; z-index:2;">
    <!-- Move question card to top -->
    <div id="question-card" style="margin-bottom:1rem; background:linear-gradient(135deg, #ffd60a 0%, #a7ffeb 100%); border-radius: 1.5rem; box-shadow: 0 4px 18px #ffd60a55; padding: 1.5rem 1rem; font-size: 1.3rem; color: #2d6a4f; position: relative; min-height: 120px; display: flex; align-items: center; justify-content: center;"></div>
    <div id="progress-bar" style="height:22px; background:linear-gradient(90deg,#6a11cb 0%,#2575fc 100%); border-radius:1rem; margin-bottom:1.2rem; margin-top:0.5rem; overflow:hidden; box-shadow:0 2px 8px #6a11cb44;">
      <div id="progress-fill" style="height:100%; width:0; background:linear-gradient(90deg,#ff9800 0%,#ff4066 100%); transition:width 0.4s cubic-bezier(.68,-0.55,.27,1.55);"></div>
    </div>
  <div id="score-panel" style="display:flex; align-items:center; justify-content:center; gap:0.7rem; font-size:1.3rem; color:#2d6a4f; margin-bottom:1rem; margin-top:1.2rem; background:linear-gradient(90deg,#f8fafc 0%, #e0f7fa 100%); border-radius:1.2rem; padding:1rem 2rem; box-shadow:0 8px 32px #e0e0e0cc;">
      <span class="score-label" style="font-weight:bold;">Score: <span id="score" style="display:inline-block; vertical-align:middle; margin-left:0.3rem;">0</span></span>
      <span class="score-badge" style="font-size:1.5rem; color:#ffd60a;">üéñÔ∏è</span>
    </div>
    <div id="answer-section" style="margin-top:1.2rem; text-align:center;"></div>
    <div id="feedback" style="margin-top:1rem; font-size:1.1rem;"></div>
    <button id="next-btn" class="btn btn-success mt-3" style="display:none;" onclick="nextQuestion()">Next</button>
    <button id="replay-btn" class="btn btn-warning mt-3" style="display:none;" onclick="startQuiz()">Play Again</button>
    <form id="complete-quiz-form" method="post" action="{% url 'complete_alphabet_quiz' lesson.id %}" style="display:none; margin-top:1.5rem; text-align:center;">
      {% csrf_token %}
      <button type="submit" id="confirm-complete-btn" class="btn btn-warning" style="font-size:1.15rem; font-weight:bold; background:linear-gradient(90deg,#ffd60a 0%,#ff4066 100%); color:#2d6a4f; border:none; border-radius:1.2rem; box-shadow:0 4px 18px #ffd60a55; padding:0.6rem 2.2rem; margin:0 1rem;">Confirm</button>
    </form>
  </div>
</div>
<script>
var lessonId = "{{ lesson.id|default:'' }}";
// Level complete screen
function showLevelComplete() {
  document.getElementById('question-card').innerHTML = `<div class='level-complete'><span class='big-trophy'>üèÜ</span><br><span class='level-text'>Game Complete!</span><br><span class='score-text'>Your Total Score: <b>${score}</b> out of <b>${questions.length}</b>!</span></div>`;
  document.getElementById('feedback').innerHTML = "<span style='color:green;'>üéâüéä Well done! You finished the game!</span>";
  document.getElementById('next-btn').style.display = 'none';
  // Create action row for all three buttons
  let actionRow = document.createElement('div');
  actionRow.style.display = 'flex';
  actionRow.style.justifyContent = 'center';
  actionRow.style.alignItems = 'flex-end';
  actionRow.style.gap = '0.7rem';
  actionRow.style.marginTop = '1.2rem';
  // Play Again button
  var replayBtn = document.getElementById('replay-btn');
  if (replayBtn) {
    replayBtn.style.display = 'inline-block';
    replayBtn.style.fontSize = '0.95rem';
    replayBtn.style.padding = '0.32rem 1.1rem';
    replayBtn.style.borderRadius = '0.7rem';
    replayBtn.style.margin = '0';
    replayBtn.style.background = 'linear-gradient(90deg,#2196f3 0%,#1976d2 100%)';
    replayBtn.style.color = '#fff';
    replayBtn.style.border = 'none';
    replayBtn.style.boxShadow = '0 4px 18px #2196f355';
    actionRow.appendChild(replayBtn);
  }
  // Confirm button (form)
  var completeForm = document.getElementById('complete-quiz-form');
  if (completeForm) {
    completeForm.style.display = 'inline-block';
    completeForm.style.margin = '0';
    completeForm.style.textAlign = 'center';
    var confirmBtn = document.getElementById('confirm-complete-btn');
    if (confirmBtn) {
      confirmBtn.style.fontSize = '0.95rem';
      confirmBtn.style.padding = '0.32rem 1.1rem';
      confirmBtn.style.borderRadius = '0.7rem';
      confirmBtn.style.margin = '0';
    }
    actionRow.appendChild(completeForm);
  }
  // Exit button
  var exitBtn = document.getElementById('exit-btn');
  if (!exitBtn) {
    exitBtn = document.createElement('button');
    exitBtn.id = 'exit-btn';
    exitBtn.className = 'btn btn-primary btn-sm';
    exitBtn.textContent = 'Exit';
    exitBtn.style.fontSize = '0.95rem';
    exitBtn.style.fontWeight = '500';
    exitBtn.style.borderRadius = '0.7rem';
    exitBtn.style.padding = '0.32rem 1.1rem';
    exitBtn.style.background = 'linear-gradient(90deg,#2196f3 0%,#1976d2 100%)';
    exitBtn.style.color = '#fff';
    exitBtn.onclick = function() {
      if (lessonId) {
        window.location.href = '/kids/lesson/' + lessonId + '/?scroll=quiz';
      } else {
        window.location.href = '/kids/?scroll=quiz';
      }
    };
  } else {
    exitBtn.style.display = 'inline-block';
    exitBtn.style.fontSize = '0.95rem';
    exitBtn.style.padding = '0.32rem 1.1rem';
    exitBtn.style.borderRadius = '0.7rem';
    exitBtn.style.margin = '0';
  }
  actionRow.appendChild(exitBtn);
  // Insert action row below question card
  let quizGame = document.getElementById('quiz-game');
  quizGame.appendChild(actionRow);
  document.getElementById('answer-section').innerHTML = '';
  updateProgress(true);
  confetti();
}
// Sound effects
const correctSound = new Audio('https://cdn.pixabay.com/audio/2022/10/16/audio_126b6b1b2e7.mp3'); // Correct
const wrongSound = new Audio('https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b2e7.mp3'); // Wrong

// Animated floating shapes

const questions = [
  { type: 'fill', letter: 'A', word: 'Apple' },
  { type: 'mcq', letter: 'B', word: 'Ball', options: ['Cat', 'Ball', 'Dog', 'Fish'] },
  { type: 'tf', letter: 'C', word: 'Cat', statement: 'Cat starts with C', answer: true },
  { type: 'before', letter: 'D', word: 'Dog', before: 'C' },
  { type: 'after', letter: 'E', word: 'Elephant', after: 'F' },
  { type: 'fill', letter: 'F', word: 'Fish' },
  { type: 'mcq', letter: 'G', word: 'Goat', options: ['Apple', 'Goat', 'Lion', 'Monkey'] },
  { type: 'tf', letter: 'H', word: 'Hat', statement: 'Hat starts with H', answer: true },
  { type: 'before', letter: 'I', word: 'Ice', before: 'H' },
  { type: 'after', letter: 'J', word: 'Jug', after: 'K' },
  { type: 'fill', letter: 'K', word: 'Kite' },
  { type: 'mcq', letter: 'L', word: 'Lion', options: ['Tiger', 'Lion', 'Bear', 'Horse'] },
  { type: 'tf', letter: 'M', word: 'Monkey', statement: 'Monkey starts with N', answer: false },
  { type: 'before', letter: 'N', word: 'Nest', before: 'M' },
  { type: 'after', letter: 'O', word: 'Orange', after: 'P' },
  { type: 'fill', letter: 'P', word: 'Pig' },
  { type: 'mcq', letter: 'Q', word: 'Queen', options: ['Apple', 'Queen', 'Dog', 'Fish'] },
  { type: 'tf', letter: 'R', word: 'Rabbit', statement: 'Rabbit starts with S', answer: false },
  { type: 'before', letter: 'S', word: 'Sun', before: 'R' },
  { type: 'after', letter: 'T', word: 'Tiger', after: 'U' },
  { type: 'fill', letter: 'U', word: 'Umbrella' },
  { type: 'mcq', letter: 'V', word: 'Violin', options: ['Lion', 'Violin', 'Monkey', 'Tiger'] },
  { type: 'tf', letter: 'W', word: 'Wolf', statement: 'Wolf starts with W', answer: true },
  { type: 'before', letter: 'X', word: 'Xylophone', before: 'W' },
  { type: 'after', letter: 'Y', word: 'Yak', after: 'Z' },
  { type: 'fill', letter: 'Z', word: 'Zebra' }
];
let current = 0;
let score = 0;

function startQuiz() {
  current = 0;
  score = 0;
  document.getElementById('score').textContent = '0';
  document.getElementById('progress-fill').style.width = '0';
  document.getElementById('replay-btn').style.display = 'none';
  // Hide Confirm and Exit buttons at start
  var completeForm = document.getElementById('complete-quiz-form');
  if (completeForm) completeForm.style.display = 'none';
  var exitBtn = document.getElementById('exit-btn');
  if (exitBtn) exitBtn.style.display = 'none';
  showQuestion();
  // Read aloud first question automatically, after voices are loaded
  if ('speechSynthesis' in window) {
    if (window.speechSynthesis.getVoices().length === 0) {
      window.speechSynthesis.onvoiceschanged = readAloud;
    } else {
      setTimeout(readAloud, 400);
    }
  }
}
function showQuestion() {
  const q = questions[current];
  // ...existing code...
  // Show question number
  let qnNo = `<div id='qnNo' style='width:100%; text-align:center; font-size:1.1rem; color:#005f73; font-family:"Baloo 2",cursive; font-weight:bold; margin-bottom:0.7rem;'>Question ${current+1} of ${questions.length}</div>`;
  if(document.getElementById('qnNo')) {
    document.getElementById('qnNo').outerHTML = '';
  }
  let questionDiv = document.getElementById('question-card');
  if (!questionDiv) {
    questionDiv = document.getElementById('quiz-game-question');
    if (!questionDiv) {
      questionDiv = document.createElement('div');
      questionDiv.id = 'quiz-game-question';
      questionDiv.style.textAlign = 'center';
      questionDiv.style.marginBottom = '2rem';
      document.getElementById('quiz-game').insertBefore(questionDiv, document.getElementById('answer-section'));
    }
  }
  // Remove previous question number bar if exists
  let prevBar = document.getElementById('qnNoBar');
  if (prevBar) prevBar.remove();
  // Insert question number above question card with Read Aloud button to the right
  let readAloudBtn = `<button id='read-aloud-btn' class='btn btn-info' style='float:right; margin-left:0.7rem; font-size:0.95rem; padding:0.2rem 0.7rem; border-radius:0.7rem;' onclick='readAloud()'>üîä</button>`;
  document.getElementById('question-card').insertAdjacentHTML('beforebegin', `<div id='qnNoBar' style='width:100%; display:flex; align-items:center; justify-content:space-between; margin-bottom:0.7rem;'><span style='flex:1; text-align:center; font-size:1.1rem; color:#005f73; font-family:"Baloo 2",cursive; font-weight:bold;'>Question ${current+1} of ${questions.length}</span>${readAloudBtn}</div>`);
  let html = '';
  let answerHtml = '';
  let questionText = '';
  if(q.type === 'fill') {
    questionText = `Which word starts with ${q.letter}?`;
    html = `<div style='font-size:1.5rem; color:#ff4066;'><b>${questionText.replace(q.letter, `<span style='color:#ff9800;'>${q.letter}</span>`)}</b></div>`;
    answerHtml = `<input type='text' id='answer' class='form-control' placeholder='Type your answer'> <button class='btn btn-primary mt-2' onclick='submitAnswer()'>Submit</button>`;
  } else if(q.type === 'mcq') {
    questionText = `Which word starts with ${q.letter}?`;
    html = `<div style='font-size:1.5rem; color:#ff4066;'><b>${questionText.replace(q.letter, `<span style='color:#ff9800;'>${q.letter}</span>`)}</b></div>`;
    answerHtml = q.options.map(opt => `<button class='btn btn-outline-primary m-1' onclick='submitMCQ("${opt}")'>${opt}</button>`).join('');
  } else if(q.type === 'tf') {
    questionText = `True or False: ${q.statement}`;
    html = `<div style='font-size:1.3rem; color:#ff4066;'><b>True or False:</b><br>${q.statement}</div>`;
    answerHtml = `<button class='btn btn-success m-1' onclick='submitTF(true)'>True</button> <button class='btn btn-danger m-1' onclick='submitTF(false)'>False</button>`;
  } else if(q.type === 'before') {
    questionText = `Which letter comes before ${q.letter}?`;
    html = `<div style='font-size:1.3rem; color:#ff4066;'><b>${questionText.replace(q.letter, `<span style='color:#ff9800;'>${q.letter}</span>`)}</b></div>`;
    answerHtml = `<input type='text' id='answer' class='form-control' placeholder='Type your answer'> <button class='btn btn-primary mt-2' onclick='submitBefore()'>Submit</button>`;
  } else if(q.type === 'after') {
    questionText = `Which letter comes after ${q.letter}?`;
    html = `<div style='font-size:1.3rem; color:#ff4066;'><b>${questionText.replace(q.letter, `<span style='color:#ff9800;'>${q.letter}</span>`)}</b></div>`;
    answerHtml = `<input type='text' id='answer' class='form-control' placeholder='Type your answer'> <button class='btn btn-primary mt-2' onclick='submitAfter()'>Submit</button>`;
  }
  questionDiv.innerHTML = html;
  document.getElementById('answer-section').innerHTML = answerHtml;
  document.getElementById('feedback').textContent = '';
  document.getElementById('next-btn').style.display = 'none';
  // Hide Confirm and Exit buttons during questions
  var completeForm = document.getElementById('complete-quiz-form');
  if (completeForm) completeForm.style.display = 'none';
  var exitBtn = document.getElementById('exit-btn');
  if (exitBtn) exitBtn.style.display = 'none';
    // Store current question text for reading aloud
    window.currentQuestionText = questionText;
  }

  // Read Aloud logic using Web Speech API
  function readAloud() {
  if (!window.currentQuestionText) return;
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel(); // Stop any previous speech
    const speak = () => {
      const utter = new SpeechSynthesisUtterance(window.currentQuestionText);
      utter.rate = 0.7; // slower rate
      utter.pitch = 1.5; // higher pitch for child-like
      utter.lang = 'en-US';
      const voices = window.speechSynthesis.getVoices();
      let childVoice = voices.find(v => v.name.toLowerCase().includes('child') && (v.gender === 'female' || v.name.toLowerCase().includes('female')));
      if (!childVoice) {
        // fallback: pick a female voice
        childVoice = voices.find(v => v.gender === 'female' || v.name.toLowerCase().includes('female'));
      }
      if (childVoice) utter.voice = childVoice;
      window.speechSynthesis.speak(utter);
    };
    // If voices are not loaded yet, wait for them
    if (window.speechSynthesis.getVoices().length === 0) {
      window.speechSynthesis.onvoiceschanged = speak;
    } else {
      speak();
    }
  } else {
    alert('Sorry, your browser does not support speech synthesis.');
  }
}
function submitAnswer() {
  const q = questions[current];
  const ans = document.getElementById('answer').value.trim().toLowerCase();
  if(ans.length > 0 && ans[0] === q.letter.toLowerCase()) {
    score++;
    document.getElementById('feedback').innerHTML = `<span style='color:green;'>üéâü•≥ Correct! <b>${ans}</b> starts with ${q.letter}!</span>`;
    confetti();
    correctSound.play();
  } else {
    document.getElementById('feedback').innerHTML = `<span style='color:red;'>‚ùåüò¢ Oops! The answer should start with <b>${q.letter}</b>. Example: <b>${q.word}</b>`;
    wrongSound.play();
  }
  document.getElementById('score').textContent = `${score}`;
  document.getElementById('next-btn').style.display = 'inline-block';
  document.getElementById('answer-section').innerHTML = '';
  updateProgress();
}
function submitMCQ(selected) {
  const q = questions[current];
  if(selected.length > 0 && selected[0].toLowerCase() === q.letter.toLowerCase()) {
    score++;
    document.getElementById('feedback').innerHTML = `<span style='color:green;'>üéâü•≥ Correct! <b>${selected}</b> starts with ${q.letter}!</span>`;
    confetti();
    correctSound.play();
  } else {
    document.getElementById('feedback').innerHTML = `<span style='color:red;'>‚ùåüò¢ Oops! The answer should start with <b>${q.letter}</b>. Example: <b>${q.word}</b>`;
    wrongSound.play();
  }
  document.getElementById('score').textContent = `${score}`;
  document.getElementById('next-btn').style.display = 'inline-block';
  document.getElementById('answer-section').innerHTML = '';
  updateProgress();
}
function submitTF(selected) {
  const q = questions[current];
  if(selected === q.answer) {
    score++;
    document.getElementById('feedback').innerHTML = `<span style='color:green;'>üéâü•≥ Correct!</span>`;
    confetti();
    correctSound.play();
  } else {
    document.getElementById('feedback').innerHTML = `<span style='color:red;'>‚ùåüò¢ Oops! That's incorrect.</span>`;
    wrongSound.play();
  }
  document.getElementById('score').textContent = `${score}`;
  document.getElementById('next-btn').style.display = 'inline-block';
  document.getElementById('answer-section').innerHTML = '';
  updateProgress();
}
function submitBefore() {
  const q = questions[current];
  const ans = document.getElementById('answer').value.trim().toUpperCase();
  if(ans === q.before) {
    score++;
    document.getElementById('feedback').innerHTML = `<span style='color:green;'>üéâü•≥ Correct! ${q.before} comes before ${q.letter}!</span>`;
    confetti();
    correctSound.play();
  } else {
    document.getElementById('feedback').innerHTML = `<span style='color:red;'>‚ùåüò¢ Oops! The correct answer is <b>${q.before}</b>.</span>`;
    wrongSound.play();
  }
  document.getElementById('score').textContent = `${score}`;
  document.getElementById('next-btn').style.display = 'inline-block';
  document.getElementById('answer-section').innerHTML = '';
  updateProgress();
}
function submitAfter() {
  const q = questions[current];
  const ans = document.getElementById('answer').value.trim().toUpperCase();
  if(ans === q.after) {
    score++;
    document.getElementById('feedback').innerHTML = `<span style='color:green;'>üéâü•≥ Correct! ${q.after} comes after ${q.letter}!</span>`;
    confetti();
    correctSound.play();
  } else {
    document.getElementById('feedback').innerHTML = `<span style='color:red;'>‚ùåüò¢ Oops! The correct answer is <b>${q.after}</b>.</span>`;
    wrongSound.play();
  }
  document.getElementById('score').textContent = `${score}`;
  document.getElementById('next-btn').style.display = 'inline-block';
  document.getElementById('answer-section').innerHTML = '';
  updateProgress();
}
function nextQuestion() {
  current++;
  if(current < questions.length) {
    showQuestion();
    // Read aloud next question automatically, after voices are loaded
    if ('speechSynthesis' in window) {
      if (window.speechSynthesis.getVoices().length === 0) {
        window.speechSynthesis.onvoiceschanged = readAloud;
      } else {
        setTimeout(readAloud, 400);
      }
    }
  } else {
    showResult();
  }
}
function showResult() {
  if (score >= 20) {
    showLevelComplete();
    // Mark quiz as completed in localStorage
    if (window.localStorage) {
      localStorage.setItem('alphabetQuizCompleted', 'true');
    }
  } else {
    document.getElementById('question-card').innerHTML = `<div class='level-complete'><span class='big-trophy'>üòî</span><br><span class='level-text'>Try Again!</span><br><span class='score-text'>You scored <b>${score}</b> out of <b>${questions.length}</b>. You need 20 or more to complete the quiz.</span></div>`;
    document.getElementById('feedback').innerHTML = "<span style='color:red;'>You need to score 20 or more to complete the quiz. Please try again!</span>";
    document.getElementById('next-btn').style.display = 'none';
    document.getElementById('replay-btn').style.display = 'inline-block';
    // Show Exit button
    if (!document.getElementById('exit-btn')) {
      const exitBtn = document.createElement('button');
      exitBtn.id = 'exit-btn';
      exitBtn.className = 'btn btn-danger mt-3';
      exitBtn.style.marginLeft = '1rem';
      exitBtn.textContent = 'Exit';
      exitBtn.onclick = function() {
        window.location.href = '/kids/lesson/{{ lesson.id }}/';
      };
      document.getElementById('replay-btn').after(exitBtn);
    }
    document.getElementById('answer-section').innerHTML = '';
    updateProgress(true);
    // Mark quiz as not completed
    if (window.localStorage) {
      localStorage.setItem('alphabetQuizCompleted', 'false');
    }
  }
}
function updateProgress(finish=false) {
  let percent = finish ? 100 : Math.round(((current+1)/questions.length)*100);
  document.getElementById('progress-fill').style.width = percent + '%';
}
function confetti() {
  const c = document.createElement('div');
  c.textContent = 'üéâ';
  c.style.position = 'fixed';
  c.style.left = (Math.random()*80+10)+'vw';
  c.style.top = (Math.random()*40+20)+'vh';
  c.style.fontSize = '2.5rem';
  c.style.pointerEvents = 'none';
  c.style.animation = 'confettiAnim 1.2s ease-out';
  document.body.appendChild(c);
  setTimeout(()=>document.body.removeChild(c),1200);
}
startQuiz();
</script>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
<style>
body, h1, h2, h3, h4, h5, h6, #question-card, #score-panel, .btn, #progress-bar, #answer-section {
  font-family: 'Baloo 2', cursive, Arial, sans-serif;
}
  body {
  background: linear-gradient(120deg, #f8ffae 0%, #e0f7fa 100%, #ffd6e0 120%);
  min-height: 100vh;
  height: 100vh;
  overflow: hidden;
  }
  .game-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1.5rem;
  margin-bottom: 2.5rem;
  position: relative;
  font-size: 2.2rem;
  font-family: 'Baloo 2', cursive;
  color: #fff;
  background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
  border-radius: 2.5rem;
  box-shadow: 0 8px 32px #38f9d799, 0 2px 8px #43e97b44;
  padding: 2rem 1.2rem 1.5rem 1.2rem;
  flex-wrap: wrap;
  letter-spacing: 1.5px;
  border: 2px solid #fffbe6;
  }
  .game-title {
    font-size: 2.2rem;
  color: #2d6a4f;
    font-family: 'Baloo 2', cursive;
    font-weight: bold;
    margin: 0 0.5rem;
    letter-spacing: 1px;
    flex: 1 1 auto;
    text-align: center;
  }
  .trophy {
  font-size: 3.2rem;
  margin-right: 1rem;
  animation: trophyBounce 1.2s infinite alternate;
  flex: 0 0 auto;
  filter: drop-shadow(0 2px 8px #ffd60a88) drop-shadow(0 0px 2px #fffbe6);
  color: #ffd60a;
  }
  .mascot-img {
    width:60px; height:60px; margin-left:0.5rem; animation: mascotBounce 1.2s infinite alternate; z-index:3; flex: 0 0 auto;
  }
  @media (max-width: 600px) {
    .game-title { font-size: 1.2rem; }
    .mascot-img { width:32px; height:32px; margin-left:0.2rem; }
    .trophy { font-size: 1.5rem; }
    .game-header { padding: 0.7rem 0.2rem; }
  }
  .game-title {
    font-size: 2.2rem;
    color: #ff4066;
    font-family: 'Baloo 2', cursive;
    font-weight: bold;
    margin: 0 0.5rem;
    letter-spacing: 1px;
  }
  .trophy {
    font-size: 2.5rem;
    margin-right: 0.5rem;
    animation: trophyBounce 1.2s infinite alternate;
  }
  .stars {
    font-size: 1.5rem;
    color: #ffd60a;
    margin-left: 0.5rem;
    letter-spacing: 2px;
  }
  @keyframes trophyBounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-12px); }
  }
  #score-panel {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.7rem;
  font-size: 1.3rem;
  color: #2d6a4f;
  margin-bottom: 1rem;
  background: linear-gradient(90deg,#a7ffeb 0%,#ffd60a 100%);
  border-radius: 1rem;
  padding: 0.5rem 1rem;
  box-shadow: 0 2px 8px #ffd60a55;
  }
  .score-label { font-weight: bold; }
  .score-stars { color: #ffd60a; font-size: 1.5rem; }
  .score-badge { font-size: 1.5rem; color: #ff4066; }
  #progress-bar {
  margin-bottom:1.2rem;
  background: linear-gradient(90deg,#a7ffeb 0%,#ffd60a 100%);
  border-radius: 1rem;
  box-shadow: 0 2px 8px #ffd60a55;
  height: 22px;
  overflow: hidden;
    position: relative;
  }
  #progress-fill {
    background: linear-gradient(90deg,#ff9800 0%,#ff4066 100%);
    border-radius: 1rem;
    transition: width 0.4s cubic-bezier(.68,-0.55,.27,1.55);
    height: 100%;
    z-index: 1;
  }
  #level-label {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 1rem;
  color: #005f73;
  font-family: 'Baloo 2', cursive;
  font-weight: bold;
  z-index: 2;
  pointer-events: none;
  }
  .level-complete {
  text-align: center;
  padding: 1rem 0.5rem;
  background: linear-gradient(120deg, #ffe066 0%, #e0f7fa 100%, #ffd6e0 120%);
  border-radius: 1rem;
  box-shadow: 0 4px 16px #ffd60a33;
  font-size: 0.9rem;
  color: #ff4066;
  animation: popIn 0.7s cubic-bezier(.68,-0.55,.27,1.55);
  }
  .big-trophy {
  font-size: 2rem;
  animation: trophyBounce 1.2s infinite alternate;
  }
  .level-text {
  font-size: 1.1rem;
  color: #ff9800;
  font-family: 'Baloo 2', cursive;
  font-weight: bold;
  margin-top: 0.3rem;
  }
  .score-text {
  font-size: 0.9rem;
  color: #005f73;
  margin-top: 0.3rem;
  }
  @keyframes popIn {
    0% { transform: scale(0.7); opacity: 0.2; }
    80% { transform: scale(1.15); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }
  @media (max-width: 900px) {
    #quiz-game {
      max-width: 98vw;
      padding: 1.2rem 0.5rem 1.2rem 0.5rem;
      margin-top: 1rem;
    }
    #question-card {
      font-size: 1.1rem;
      padding: 1rem 0.5rem;
      min-height: 80px;
    }
    #score {
      font-size: 1rem;
      padding: 0.3rem 0.7rem;
    }
    #progress-bar {
      height: 16px;
    }
    #answer-section input.form-control {
      font-size: 1rem;
      padding: 0.3rem 0.7rem;
    }
    #answer-section button, #next-btn, #replay-btn {
      font-size: 1rem;
      padding: 0.4rem 1rem;
    }
    .btn-outline-primary {
      font-size: 1rem !important;
      padding: 0.4rem 1rem !important;
    }
    .mascot-img {
      left:0; top:-10px; width:40px; height:40px;
    }
  }
  @media (max-width: 600px) {
    #quiz-game {
      max-width: 100vw;
      padding: 0.7rem 0.2rem 0.7rem 0.2rem;
      margin-top: 0.5rem;
      border-radius: 1rem;
    }
    #question-card {
      font-size: 0.95rem;
      padding: 0.6rem 0.2rem;
      min-height: 50px;
      border-radius: 0.7rem;
      margin-bottom: 2.2rem !important;
    }
    #score {
      font-size: 0.9rem;
      padding: 0.2rem 0.5rem;
      border-radius: 0.7rem;
    }
    #progress-bar {
      height: 10px;
      border-radius: 0.5rem;
    }
    #progress-fill {
      border-radius: 0.5rem;
    }
    #answer-section input.form-control {
      font-size: 0.9rem;
      padding: 0.2rem 0.5rem;
      border-radius: 0.7rem;
    }
    #answer-section button, #next-btn, #replay-btn {
      font-size: 0.9rem;
      padding: 0.3rem 0.7rem;
      border-radius: 0.7rem;
    }
    .btn-outline-primary {
      font-size: 0.9rem !important;
      padding: 0.3rem 0.7rem !important;
      border-radius: 0.7rem !important;
    }
    .mascot-img {
      left:0; top:-8px; width:32px; height:32px;
    }
    #feedback {
      font-size: 1rem;
      min-height: 1.5rem;
    }
  }
  .mascot-img {
    width:60px; height:60px; position:absolute; left:-70px; top:-10px; animation: mascotBounce 1.2s infinite alternate; z-index:3;
  }
  @media (max-width: 600px) {
    .mascot-img { left:0; top:-10px; width:40px; height:40px; }
  }
  #animated-bg {
    position: fixed;
    left: 0; top: 0; width: 100vw; height: 100vh;
    z-index: 0;
    pointer-events: none;
    background: transparent;
    overflow: hidden;
  }
  @keyframes floatShape {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-120px) scale(1.3); opacity: 0; }
  }
  #animated-bg {
    position: fixed;
    left: 0; top: 0; width: 100vw; height: 100vh;
    z-index: 0;
    pointer-events: none;
    background: transparent;
  }
  @keyframes mascotBounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-18px); }
  }
  #quiz-game {
    font-family:'Baloo 2',cursive;
    background: linear-gradient(120deg, #f8ffae 0%, #e0f7fa 100%, #ffd6e0 120%);
    border-radius: 2rem;
    box-shadow: 0 8px 32px #ffd60a33;
    padding: 2.5rem 1.2rem 2rem 1.2rem;
    margin-top: 2rem;
    position: relative;
    overflow: hidden;
  }
  #question-card {
  margin-bottom:1rem;
  background: linear-gradient(135deg, #ffd60a 0%, #a7ffeb 100%);
  border-radius: 1.5rem;
  box-shadow: 0 4px 18px #ffd60a55;
  padding: 1.5rem 1rem;
  font-size: 1.3rem;
  color: #2d6a4f;
  position: relative;
  min-height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  }
  #progress-bar {
    margin-bottom:1.2rem;
    background: linear-gradient(90deg,#ffd60a 0%,#a7ffeb 100%);
    border-radius: 1rem;
    box-shadow: 0 2px 8px #ffd60a22;
    height: 22px;
    overflow: hidden;
  }
  #progress-fill {
    background: linear-gradient(90deg,#ff9800 0%,#ff4066 100%);
    border-radius: 1rem;
    transition: width 0.4s cubic-bezier(.68,-0.55,.27,1.55);
    height: 100%;
  }
  #score {
    font-size: 1.2rem;
    color: #2d6a4f;
    margin-bottom: 1rem;
    font-weight: bold;
    background: #e0f7fa;
    border-radius: 1rem;
    padding: 0.2rem 1rem;
    display: inline-block;
    box-shadow: 0 2px 8px #ffd60a22;
    height: 1.7rem;
    line-height: 1.7rem;
  }
  #answer-section input.form-control {
    border-radius: 1rem;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    border: 2px solid #ff9800;
    box-shadow: 0 2px 8px #ffd60a22;
  }
  #answer-section button {
    border-radius: 1.2rem;
    font-size: 1.1rem;
    font-family:'Baloo 2',cursive;
    font-weight: bold;
    box-shadow: 0 2px 8px #ffd60a22;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.2s;
  }
  #answer-section button:active {
    transform: scale(0.96);
    background: #ffd60a;
    color: #ff4066;
  }
  #feedback {
    margin-top: 1rem;
    font-size: 1.3rem;
    font-family:'Comic Sans MS',cursive;
    min-height: 2.2rem;
    font-weight: bold;
    text-align: center;
  }
  #next-btn, #replay-btn {
    border-radius: 1.2rem;
    font-size: 1.1rem;
    font-family:'Baloo 2',cursive;
    font-weight: bold;
    box-shadow: 0 2px 8px #ffd60a22;
    margin-top: 1rem;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.2s;
  }
  #next-btn:active, #replay-btn:active {
    transform: scale(0.96);
    background: #ffd60a;
    color: #ff4066;
  }
  .btn-outline-primary {
    border-radius: 0.7rem !important;
    font-size: 1.1rem !important;
    font-family:'Baloo 2',cursive !important;
    font-weight: 500 !important;
    box-shadow: 0 4px 18px #e0e0e0cc !important;
    margin: 0.2rem !important;
    background: #fff !important;
    color: #2d6a4f !important;
    border: 2px solid #a7ffeb !important;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.2s !important;
  }
  .btn-outline-primary:hover {
    background: #a7ffeb !important;
    color: #2d6a4f !important;
    box-shadow: 0 8px 32px #a7ffeb88 !important;
  }
  .btn-outline-primary:active {
    transform: scale(0.96);
    background: #ffd60a !important;
    color: #ff4066 !important;
  }
  @keyframes confettiAnim {
    0% { opacity: 1; transform: scale(1) translateY(0); }
    100% { opacity: 0; transform: scale(1.5) translateY(80px); }
  }
</style>
{% endblock %}
